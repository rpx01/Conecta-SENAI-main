<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suporte de TI - Históricos de Atendimento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/brand.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/static/css/styles.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/selecao-sistema.html">
                <img src="/img/senai-logo.png" alt="SENAI" height="28" class="me-2">
                <span class="navbar-brand-text" title="Suporte de TI">Sistema FIEMG | Suporte de TI</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="/suporte_ti/abertura.html"><i class="bi bi-plus-circle me-1"></i>
                            Abrir Chamado</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/suporte_ti/meus_chamados.html"><i class="bi bi-list-check me-1"></i>
                            Meus Chamados</a>
                    </li>
                    <li class="nav-item admin-only">
                        <a class="nav-link" href="/suporte_ti/admin_chamados.html"><i
                                class="bi bi-clipboard-data me-1"></i> Chamados</a>
                    </li>
                    <li class="nav-item admin-only">
                        <a class="nav-link active" aria-current="page" href="/suporte_ti/admin_historicos.html"><i
                                class="bi bi-clock-history me-1"></i> Históricos</a>
                    </li>
                    <li class="nav-item admin-only">
                        <a class="nav-link" href="/suporte_ti/admin_indicadores.html"><i
                                class="bi bi-graph-up-arrow me-1"></i> Indicadores</a>
                    </li>
                    <li class="nav-item admin-only">
                        <a class="nav-link" href="/suporte_ti/admin_basedados.html"><i class="bi bi-database me-1"></i>
                            Base de Dados</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-lg-3">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle me-1"></i>
                            <span id="userName">Usuário</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#" id="btnLogout"><i
                                        class="bi bi-box-arrow-right me-2"></i>Sair</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container-fluid py-4">
        <div class="d-flex flex-column flex-xl-row align-items-xl-center justify-content-between mb-4">
            <div>
                <h1 class="h2 mb-1">Históricos de Atendimento</h1>
                <p class="text-muted mb-0">Consulte os chamados finalizados ou cancelados para acompanhar os
                    atendimentos realizados.</p>
            </div>
            <a class="btn btn-outline-secondary mt-3 mt-xl-0" href="/suporte_ti/admin_chamados.html">
                <i class="bi bi-arrow-left-circle me-2"></i> Voltar para chamados
            </a>
        </div>

        <section class="card">
            <div
                class="card-header bg-white d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                <h2 class="h5 mb-0"><i class="bi bi-archive me-2"></i>Chamados finalizados e cancelados</h2>
                <div class="d-flex align-items-center gap-2 mt-2 mt-md-0">
                    <span class="text-muted" id="totalHistoricos">0 registros</span>
                    <button class="btn btn-outline-secondary btn-sm" id="btnExibirTodosHistoricos">
                        Exibir todos
                    </button>
                    <button class="btn btn-outline-success btn-sm" id="btnExportarExcelHistoricos">
                        <i class="bi bi-file-earmark-spreadsheet"></i> Exportar Excel
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0" id="tabelaHistoricos">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Data</th>
                                <th scope="col">Usuário</th>
                                <th scope="col">Área</th>
                                <th scope="col">Tipo</th>
                                <th scope="col">Urgência</th>
                                <th scope="col">Status</th>
                                <th scope="col">Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <div class="modal fade" id="modalDetalhesHistorico" tabindex="-1" aria-labelledby="modalDetalhesHistoricoLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title h4" id="modalDetalhesHistoricoLabel">Detalhes do chamado</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <dl class="row" id="detalhesHistorico"></dl>
                    <div id="listaAnexosHistorico"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalEditarChamadoHistorico" tabindex="-1"
        aria-labelledby="modalEditarChamadoHistoricoLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title h4" id="modalEditarChamadoHistoricoLabel">Editar chamado</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarChamadoHistorico" class="row g-3">
                        <div class="col-md-6">
                            <label for="editarAreaHistoricoSelect" class="form-label">Área</label>
                            <select id="editarAreaHistoricoSelect" class="form-select" aria-label="Selecione a área">
                                <option value="" data-placeholder="true">Selecione...</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editarTipoEquipamentoHistoricoSelect" class="form-label">Tipo de
                                equipamento</label>
                            <select id="editarTipoEquipamentoHistoricoSelect" class="form-select"
                                aria-label="Selecione o tipo de equipamento">
                                <option value="" data-placeholder="true">Selecione...</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editarUrgenciaHistoricoSelect" class="form-label">Nível de urgência</label>
                            <select id="editarUrgenciaHistoricoSelect" class="form-select" required>
                                <option value="" data-placeholder="true">Selecione...</option>
                                <option value="Baixo">Baixo</option>
                                <option value="Médio">Médio</option>
                                <option value="Alto">Alto</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editarPatrimonioHistoricoInput" class="form-label">Patrimônio</label>
                            <input type="text" id="editarPatrimonioHistoricoInput" class="form-control"
                                placeholder="Informe o patrimônio" />
                        </div>
                        <div class="col-md-6">
                            <label for="editarNumeroSerieHistoricoInput" class="form-label">Nº de série</label>
                            <input type="text" id="editarNumeroSerieHistoricoInput" class="form-control"
                                placeholder="Informe o número de série" />
                        </div>
                        <div class="col-12">
                            <label for="editarDescricaoHistorico" class="form-label">Descrição do problema</label>
                            <textarea id="editarDescricaoHistorico" class="form-control" rows="4" required
                                placeholder="Atualize a descrição do problema"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnSalvarEdicaoHistorico">
                        <i class="bi bi-save me-2"></i>Salvar alterações
                        <!DOCTYPE html>
                        <html lang="pt-BR">

                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>Suporte de TI - Históricos de Atendimento</title>
                            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
                                rel="stylesheet">
                            <link rel="stylesheet" href="/static/css/brand.css">
                            <link
                                href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
                                rel="stylesheet">
                            <link href="/static/css/styles.css" rel="stylesheet">
                        </head>

                        <body>
                            <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
                                <div class="container-fluid">
                                    <a class="navbar-brand d-flex align-items-center" href="/selecao-sistema.html">
                                        <img src="/img/senai-logo.png" alt="SENAI" height="28" class="me-2">
                                        <span class="navbar-brand-text" title="Suporte de TI">Sistema FIEMG | Suporte de
                                            TI</span>
                                    </a>
                                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#navbarNav">
                                        <span class="navbar-toggler-icon"></span>
                                    </button>
                                    <div class="collapse navbar-collapse" id="navbarNav">
                                        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                                            <li class="nav-item">
                                                <a class="nav-link" href="/suporte_ti/abertura.html"><i
                                                        class="bi bi-plus-circle me-1"></i>
                                                    Abrir Chamado</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" href="/suporte_ti/meus_chamados.html"><i
                                                        class="bi bi-list-check me-1"></i>
                                                    Meus Chamados</a>
                                            </li>
                                            <li class="nav-item admin-only">
                                                <a class="nav-link" href="/suporte_ti/admin_chamados.html"><i
                                                        class="bi bi-clipboard-data me-1"></i> Chamados</a>
                                            </li>
                                            <li class="nav-item admin-only">
                                                <a class="nav-link active" aria-current="page"
                                                    href="/suporte_ti/admin_historicos.html"><i
                                                        class="bi bi-clock-history me-1"></i> Históricos</a>
                                            </li>
                                            <li class="nav-item admin-only">
                                                <a class="nav-link" href="/suporte_ti/admin_indicadores.html"><i
                                                        class="bi bi-graph-up-arrow me-1"></i> Indicadores</a>
                                            </li>
                                            <li class="nav-item admin-only">
                                                <a class="nav-link" href="/suporte_ti/admin_basedados.html"><i
                                                        class="bi bi-database me-1"></i>
                                                    Base de Dados</a>
                                            </li>
                                        </ul>
                                        <ul class="navbar-nav ms-lg-3">
                                            <li class="nav-item dropdown">
                                                <a class="nav-link dropdown-toggle" href="#" id="userDropdown"
                                                    role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <i class="bi bi-person-circle me-1"></i>
                                                    <span id="userName">Usuário</span>
                                                </a>
                                                <ul class="dropdown-menu dropdown-menu-end"
                                                    aria-labelledby="userDropdown">
                                                    <li>
                                                        <hr class="dropdown-divider">
                                                    </li>
                                                    <li><a class="dropdown-item" href="#" id="btnLogout"><i
                                                                class="bi bi-box-arrow-right me-2"></i>Sair</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </nav>

                            <main class="container-fluid py-4">
                                <div
                                    class="d-flex flex-column flex-xl-row align-items-xl-center justify-content-between mb-4">
                                    <div>
                                        <h1 class="h2 mb-1">Históricos de Atendimento</h1>
                                        <p class="text-muted mb-0">Consulte os chamados finalizados ou cancelados para
                                            acompanhar os
                                            atendimentos realizados.</p>
                                    </div>
                                    <a class="btn btn-outline-secondary mt-3 mt-xl-0"
                                        href="/suporte_ti/admin_chamados.html">
                                        <i class="bi bi-arrow-left-circle me-2"></i> Voltar para chamados
                                    </a>
                                </div>

                                <section class="card">
                                    <div
                                        class="card-header bg-white d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                                        <h2 class="h5 mb-0"><i class="bi bi-archive me-2"></i>Chamados finalizados e
                                            cancelados</h2>
                                        <div class="d-flex align-items-center gap-2 mt-2 mt-md-0">
                                            <span class="text-muted" id="totalHistoricos">0 registros</span>
                                            <button class="btn btn-outline-secondary btn-sm"
                                                id="btnExibirTodosHistoricos">
                                                Exibir todos
                                            </button>
                                            <button class="btn btn-outline-success btn-sm"
                                                id="btnExportarExcelHistoricos">
                                                <i class="bi bi-file-earmark-spreadsheet"></i> Exportar Excel
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0" id="tabelaHistoricos">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th scope="col">#</th>
                                                        <th scope="col">Data</th>
                                                        <th scope="col">Usuário</th>
                                                        <th scope="col">Área</th>
                                                        <th scope="col">Tipo</th>
                                                        <th scope="col">Urgência</th>
                                                        <th scope="col">Status</th>
                                                        <th scope="col">Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </section>
                            </main>

                            <div class="modal fade" id="modalDetalhesHistorico" tabindex="-1"
                                aria-labelledby="modalDetalhesHistoricoLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h2 class="modal-title h4" id="modalDetalhesHistoricoLabel">Detalhes do
                                                chamado</h2>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Fechar"></button>
                                        </div>
                                        <div class="modal-body">
                                            <dl class="row" id="detalhesHistorico"></dl>
                                            <div id="listaAnexosHistorico"></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-outline-secondary"
                                                data-bs-dismiss="modal">Fechar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="modalEditarChamadoHistorico" tabindex="-1"
                                aria-labelledby="modalEditarChamadoHistoricoLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h2 class="modal-title h4" id="modalEditarChamadoHistoricoLabel">Editar
                                                chamado</h2>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Fechar"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form id="formEditarChamadoHistorico" class="row g-3">
                                                <div class="col-md-6">
                                                    <label for="editarAreaHistoricoSelect"
                                                        class="form-label">Área</label>
                                                    <select id="editarAreaHistoricoSelect" class="form-select"
                                                        aria-label="Selecione a área">
                                                        <option value="" data-placeholder="true">Selecione...</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="editarTipoEquipamentoHistoricoSelect"
                                                        class="form-label">Tipo de
                                                        equipamento</label>
                                                    <select id="editarTipoEquipamentoHistoricoSelect"
                                                        class="form-select"
                                                        aria-label="Selecione o tipo de equipamento">
                                                        <option value="" data-placeholder="true">Selecione...</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="editarUrgenciaHistoricoSelect" class="form-label">Nível
                                                        de urgência</label>
                                                    <select id="editarUrgenciaHistoricoSelect" class="form-select"
                                                        required>
                                                        <option value="" data-placeholder="true">Selecione...</option>
                                                        <option value="Baixo">Baixo</option>
                                                        <option value="Médio">Médio</option>
                                                        <option value="Alto">Alto</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="editarPatrimonioHistoricoInput"
                                                        class="form-label">Patrimônio</label>
                                                    <input type="text" id="editarPatrimonioHistoricoInput"
                                                        class="form-control" placeholder="Informe o patrimônio" />
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="editarNumeroSerieHistoricoInput" class="form-label">Nº
                                                        de série</label>
                                                    <input type="text" id="editarNumeroSerieHistoricoInput"
                                                        class="form-control" placeholder="Informe o número de série" />
                                                </div>
                                                <div class="col-12">
                                                    <label for="editarDescricaoHistorico" class="form-label">Descrição
                                                        do problema</label>
                                                    <textarea id="editarDescricaoHistorico" class="form-control"
                                                        rows="4" required
                                                        placeholder="Atualize a descrição do problema"></textarea>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-outline-secondary"
                                                data-bs-dismiss="modal">Cancelar</button>
                                            <button type="button" class="btn btn-primary" id="btnSalvarEdicaoHistorico">
                                                <i class="bi bi-save me-2"></i>Salvar alterações
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script
                                src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
                            <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.4/dist/purify.min.js"></script>
                            <script src="/js/app.js"></script>
                            <script src="/js/suporte_ti/admin_historicos.js?v=20251120"></script>
                        </body>

                        </html>